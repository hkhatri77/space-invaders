(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';

;
(function () {

    var Game = function Game() {

        var canvas = document.getElementById('space-invaders');

        var screen = canvas.getContext('2d');
        var gameSize = {
            x: canvas.width,
            y: canvas.height
        };

        this.bodies = [];
        this.bodies = this.bodies.concat(createInvaders(this));
        this.bodies = this.bodies.concat(new Player(this, gameSize));
        this.shootSound = document.getElementById('shoot-sound');

        var self = this;

        var tick = function tick() {
            self.update();
            self.draw(screen, gameSize);
            requestAnimationFrame(tick);
        };

        tick();
    };

    Game.prototype = {

        update: function update() {
            var self = this;

            var notCollidingWithAnything = function notCollidingWithAnything(b1) {
                return self.bodies.filter(function (b2) {
                    return colliding(b1, b2);
                }).length === 0;
            };

            this.bodies = this.bodies.filter(notCollidingWithAnything);

            for (var i = 0; i < this.bodies.length; i++) {
                this.bodies[i].update();
            }
        },

        draw: function draw(screen, gameSize) {
            screen.clearRect(0, 0, gameSize.x, gameSize.y);

            for (var i = 0; i < this.bodies.length; i++) {
                drawRect(screen, this.bodies[i]);
            }
        },

        invadersBelow: function invadersBelow(invader) {

            return this.bodies.filter(function (b) {

                return b instanceof Invader && Math.abs(invader.center.x - b.center.x) < b.size.x && b.center.y > invader.center.y;
            }).length > 0;
        },

        addBody: function addBody(body) {
            this.bodies.push(body);
        }
    };

    var Invader = function Invader(game, center) {
        this.game = game;
        this.center = center;
        this.size = {
            x: 15,
            y: 15
        };

        this.patrolX = 0;

        this.speedX = 0.3;
    };

    Invader.prototype = {

        update: function update() {

            if (this.patrolX < 0 || this.patrolX > 30) {

                this.speedX = -this.speedX;
            }

            if (Math.random() > 0.995 && !this.game.invadersBelow(this)) {

                var bullet = new Bullet({
                    x: this.center.x,
                    y: this.center.y + this.size.y / 2
                }, {
                    x: Math.random() - 0.5,
                    y: 2
                });

                this.game.addBody(bullet);
            }

            this.center.x += this.speedX;

            this.patrolX += this.speedX;
        }
    };

    var createInvaders = function createInvaders(game) {
        var invaders = [];
        for (var i = 0; i < 24; i++) {

            var x = 30 + i % 8 * 30;

            var y = 30 + i % 3 * 30;

            invaders.push(new Invader(game, {
                x: x,
                y: y
            }));
        }

        return invaders;
    };

    var Player = function Player(game, gameSize) {
        this.game = game;
        this.size = {
            x: 15,
            y: 15
        };
        this.center = {
            x: gameSize.x / 2,
            y: gameSize.y - this.size.y * 2
        };

        this.keyboarder = new Keyboarder();
    };

    Player.prototype = {

        update: function update() {
            if (this.keyboarder.isDown(this.keyboarder.KEYS.LEFT)) {

                this.center.x -= 2;
            } else if (this.keyboarder.isDown(this.keyboarder.KEYS.RIGHT)) {
                this.center.x += 2;
            }

            if (this.keyboarder.isDown(this.keyboarder.KEYS.S)) {
                var bullet = new Bullet({
                    x: this.center.x,
                    y: this.center.y - this.size.y - 10
                }, {
                    x: 0,
                    y: -7
                });

                this.game.addBody(bullet);
                this.game.shootSound.load();
                this.game.shootSound.play();
            }
        }
    };

    var Bullet = function Bullet(center, velocity) {
        this.center = center;
        this.size = {
            x: 3,
            y: 3
        };
        this.velocity = velocity;
    };

    Bullet.prototype = {

        update: function update() {

            this.center.x += this.velocity.x;
            this.center.y += this.velocity.y;
        }
    };

    var Keyboarder = function Keyboarder() {

        var keyState = {};

        window.addEventListener('keydown', function (e) {
            keyState[e.keyCode] = true;
        });

        window.addEventListener('keyup', function (e) {
            keyState[e.keyCode] = false;
        });

        this.isDown = function (keyCode) {
            return keyState[keyCode] === true;
        };

        this.KEYS = {
            LEFT: 37,
            RIGHT: 39,
            S: 83
        };
    };
    var drawRect = function drawRect(screen, body) {
        screen.fillRect(body.center.x - body.size.x / 2, body.center.y - body.size.y / 2, body.size.x, body.size.y);
    };

    var colliding = function colliding(b1, b2) {
        return !(b1 === b2 || b1.center.x + b1.size.x / 2 < b2.center.x - b2.size.x / 2 || b1.center.y + b1.size.y / 2 < b2.center.y - b2.size.y / 2 || b1.center.x - b1.size.x / 2 > b2.center.x + b2.size.x / 2 || b1.center.y - b1.size.y / 2 > b2.center.y + b2.size.y / 2);
    };

    window.addEventListener('load', function () {
        new Game();
    });
})();

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset:utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCIvVXNlcnMvaGFubmFoc3VtbmVyL0dpdGh1YiBQcm9qZWN0cy9zcGFjZS1pbnZhZGVyczIvanMvYXBwLWJyb3dzZXJpZnkuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7OztBQ0FBLENBQUM7QUFDRCxDQUFDLFlBQVc7O0FBRVIsUUFBSSxJQUFJLEdBQUcsU0FBUCxJQUFJLEdBQWM7O0FBRWxCLFlBQUksTUFBTSxHQUFHLFFBQVEsQ0FBQyxjQUFjLENBQUMsZ0JBQWdCLENBQUMsQ0FBQzs7QUFFdkQsWUFBSSxNQUFNLEdBQUcsTUFBTSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUNyQyxZQUFJLFFBQVEsR0FBRztBQUNYLGFBQUMsRUFBRSxNQUFNLENBQUMsS0FBSztBQUNmLGFBQUMsRUFBRSxNQUFNLENBQUMsTUFBTTtTQUNuQixDQUFDOztBQUVGLFlBQUksQ0FBQyxNQUFNLEdBQUcsRUFBRSxDQUFDO0FBQ2pCLFlBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7QUFDdkQsWUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLE1BQU0sQ0FBQyxJQUFJLEVBQUUsUUFBUSxDQUFDLENBQUMsQ0FBQztBQUM3RCxZQUFJLENBQUMsVUFBVSxHQUFHLFFBQVEsQ0FBQyxjQUFjLENBQUMsYUFBYSxDQUFDLENBQUM7O0FBRXpELFlBQUksSUFBSSxHQUFHLElBQUksQ0FBQzs7QUFFaEIsWUFBSSxJQUFJLEdBQUcsU0FBUCxJQUFJLEdBQWM7QUFDbEIsZ0JBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztBQUNkLGdCQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxRQUFRLENBQUMsQ0FBQztB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QUFFLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLElBQ3pELEVBQUUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLElBQ3pELEVBQUUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLElBQ3pELEVBQUUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUEsQUFDNUQsQ0FBQztLQUNMLENBQUM7O0FBRUYsVUFBTSxDQUFDLGdCQUFnQixDQUFDLE1BQU0sRUFBRSxZQUFXO0FBQ3ZDLFlBQUksSUFBSSxFQUFFLENBQUM7S0FDZCxDQUFDLENBQUM7Q0FDTixDQUFBLEVBQUcsQ0FBQyIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCI7XG4oZnVuY3Rpb24oKSB7XG5cbiAgICB2YXIgR2FtZSA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIHZhciBjYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInNwYWNlLWludmFkZXJzXCIpO1xuXG4gICAgICAgIHZhciBzY3JlZW4gPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICAgICAgdmFyIGdhbWVTaXplID0ge1xuICAgICAgICAgICAgeDogY2FudmFzLndpZHRoLFxuICAgICAgICAgICAgeTogY2FudmFzLmhlaWdodFxuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMuYm9kaWVzID0gW107XG4gICAgICAgIHRoaXMuYm9kaWVzID0gdGhpcy5ib2RpZXMuY29uY2F0KGNyZWF0ZUludmFkZXJzKHRoaXMpKTtcbiAgICAgICAgdGhpcy5ib2RpZXMgPSB0aGlzLmJvZGllcy5jb25jYXQobmV3IFBsYXllcih0aGlzLCBnYW1lU2l6ZSkpO1xuICAgICAgICB0aGlzLnNob290U291bmQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2hvb3Qtc291bmQnKTtcblxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgdmFyIHRpY2sgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHNlbGYudXBkYXRlKCk7XG4gICAgICAgICAgICBzZWxmLmRyYXcoc2NyZWVuLCBnYW1lU2l6ZSk7XG4gICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUodGljayk7XG4gICAgICAgIH07XG5cblxuICAgICAgICB0aWNrKCk7XG4gICAgfTtcblxuICAgIEdhbWUucHJvdG90eXBlID0ge1xuXG5cbiAgICAgICAgdXBkYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgICAgICAgICAgdmFyIG5vdENvbGxpZGluZ1dpdGhBbnl0aGluZyA9IGZ1bmN0aW9uKGIxKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuYm9kaWVzLmZpbHRlcihmdW5jdGlvbihiMikge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29sbGlkaW5nKGIxLCBiMik7XG4gICAgICAgICAgICAgICAgfSkubGVuZ3RoID09PSAwO1xuICAgICAgICAgICAgfTtcblxuXG4gICAgICAgICAgICB0aGlzLmJvZGllcyA9IHRoaXMuYm9kaWVzLmZpbHRlcihub3RDb2xsaWRpbmdXaXRoQW55dGhpbmcpO1xuXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuYm9kaWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ib2RpZXNbaV0udXBkYXRlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgZHJhdzogZnVuY3Rpb24oc2NyZWVuLCBnYW1lU2l6ZSkge1xuICAgICAgICAgICAgc2NyZWVuLmNsZWFyUmVjdCgwLCAwLCBnYW1lU2l6ZS54LCBnYW1lU2l6ZS55KTtcblxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmJvZGllcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGRyYXdSZWN0KHNjcmVlbiwgdGhpcy5ib2RpZXNbaV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGludmFkZXJzQmVsb3c6IGZ1bmN0aW9uKGludmFkZXIpIHtcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuYm9kaWVzLmZpbHRlcihmdW5jdGlvbihiKSB7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gYiBpbnN0YW5jZW9mIEludmFkZXIgJiZcbiAgICAgICAgICAgICAgICAgICAgTWF0aC5hYnMoaW52YWRlci5jZW50ZXIueCAtIGIuY2VudGVyLngpIDwgYi5zaXplLnggJiZcbiAgICAgICAgICAgICAgICAgICAgYi5jZW50ZXIueSA+IGludmFkZXIuY2VudGVyLnk7XG4gICAgICAgICAgICB9KS5sZW5ndGggPiAwO1xuICAgICAgICB9LFxuXG4gICAgICAgIGFkZEJvZHk6IGZ1bmN0aW9uKGJvZHkpIHtcbiAgICAgICAgICAgIHRoaXMuYm9kaWVzLnB1c2goYm9keSk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgdmFyIEludmFkZXIgPSBmdW5jdGlvbihnYW1lLCBjZW50ZXIpIHtcbiAgICAgICAgdGhpcy5nYW1lID0gZ2FtZTtcbiAgICAgICAgdGhpcy5jZW50ZXIgPSBjZW50ZXI7XG4gICAgICAgIHRoaXMuc2l6ZSA9IHtcbiAgICAgICAgICAgIHg6IDE1LFxuICAgICAgICAgICAgeTogMTVcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLnBhdHJvbFggPSAwO1xuXG4gICAgICAgIHRoaXMuc3BlZWRYID0gMC4zO1xuICAgIH07XG5cbiAgICBJbnZhZGVyLnByb3RvdHlwZSA9IHtcblxuICAgICAgICB1cGRhdGU6IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICBpZiAodGhpcy5wYXRyb2xYIDwgMCB8fCB0aGlzLnBhdHJvbFggPiAzMCkge1xuXG4gICAgICAgICAgICAgICAgdGhpcy5zcGVlZFggPSAtdGhpcy5zcGVlZFg7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChNYXRoLnJhbmRvbSgpID4gMC45OTUgJiZcbiAgICAgICAgICAgICAgICAhdGhpcy5nYW1lLmludmFkZXJzQmVsb3codGhpcykpIHtcblxuICAgICAgICAgICAgICAgIHZhciBidWxsZXQgPSBuZXcgQnVsbGV0KHtcbiAgICAgICAgICAgICAgICAgICAgeDogdGhpcy5jZW50ZXIueCxcbiAgICAgICAgICAgICAgICAgICAgeTogdGhpcy5jZW50ZXIueSArIHRoaXMuc2l6ZS55IC8gMlxuICAgICAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICAgICAgeDogTWF0aC5yYW5kb20oKSAtIDAuNSxcbiAgICAgICAgICAgICAgICAgICAgeTogMlxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5nYW1lLmFkZEJvZHkoYnVsbGV0KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5jZW50ZXIueCArPSB0aGlzLnNwZWVkWDtcblxuICAgICAgICAgICAgdGhpcy5wYXRyb2xYICs9IHRoaXMuc3BlZWRYO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIHZhciBjcmVhdGVJbnZhZGVycyA9IGZ1bmN0aW9uKGdhbWUpIHtcbiAgICAgICAgdmFyIGludmFkZXJzID0gW107XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgMjQ7IGkrKykge1xuXG4gICAgICAgICAgICB2YXIgeCA9IDMwICsgKGkgJSA4KSAqIDMwO1xuXG4gICAgICAgICAgICB2YXIgeSA9IDMwICsgKGkgJSAzKSAqIDMwO1xuXG4gICAgICAgICAgICBpbnZhZGVycy5wdXNoKG5ldyBJbnZhZGVyKGdhbWUsIHtcbiAgICAgICAgICAgICAgICB4OiB4LFxuICAgICAgICAgICAgICAgIHk6IHlcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBpbnZhZGVycztcbiAgICB9O1xuXG5cbiAgICB2YXIgUGxheWVyID0gZnVuY3Rpb24oZ2FtZSwgZ2FtZVNpemUpIHtcbiAgICAgICAgdGhpcy5nYW1lID0gZ2FtZTtcbiAgICAgICAgdGhpcy5zaXplID0ge1xuICAgICAgICAgICAgeDogMTUsXG4gICAgICAgICAgICB5OiAxNVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmNlbnRlciA9IHtcbiAgICAgICAgICAgIHg6IGdhbWVTaXplLnggLyAyLFxuICAgICAgICAgICAgeTogZ2FtZVNpemUueSAtIHRoaXMuc2l6ZS55ICogMlxuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMua2V5Ym9hcmRlciA9IG5ldyBLZXlib2FyZGVyKCk7XG4gICAgfTtcblxuICAgIFBsYXllci5wcm90b3R5cGUgPSB7XG5cbiAgICAgICAgdXBkYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmtleWJvYXJkZXIuaXNEb3duKHRoaXMua2V5Ym9hcmRlci5LRVlTLkxFRlQpKSB7XG5cbiAgICAgICAgICAgICAgICB0aGlzLmNlbnRlci54IC09IDI7XG5cbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5rZXlib2FyZGVyLmlzRG93bih0aGlzLmtleWJvYXJkZXIuS0VZUy5SSUdIVCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNlbnRlci54ICs9IDI7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmtleWJvYXJkZXIuaXNEb3duKHRoaXMua2V5Ym9hcmRlci5LRVlTLlMpKSB7XG4gICAgICAgICAgICAgICAgdmFyIGJ1bGxldCA9IG5ldyBCdWxsZXQoe1xuICAgICAgICAgICAgICAgICAgICB4OiB0aGlzLmNlbnRlci54LFxuICAgICAgICAgICAgICAgICAgICB5OiB0aGlzLmNlbnRlci55IC0gdGhpcy5zaXplLnkgLSAxMFxuICAgICAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICAgICAgeDogMCxcbiAgICAgICAgICAgICAgICAgICAgeTogLTdcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHRoaXMuZ2FtZS5hZGRCb2R5KGJ1bGxldCk7XG4gICAgICAgICAgICAgICAgdGhpcy5nYW1lLnNob290U291bmQubG9hZCgpO1xuICAgICAgICAgICAgICAgIHRoaXMuZ2FtZS5zaG9vdFNvdW5kLnBsYXkoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG5cbiAgICB2YXIgQnVsbGV0ID0gZnVuY3Rpb24oY2VudGVyLCB2ZWxvY2l0eSkge1xuICAgICAgICB0aGlzLmNlbnRlciA9IGNlbnRlcjtcbiAgICAgICAgdGhpcy5zaXplID0ge1xuICAgICAgICAgICAgeDogMyxcbiAgICAgICAgICAgIHk6IDNcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy52ZWxvY2l0eSA9IHZlbG9jaXR5O1xuICAgIH07XG5cbiAgICBCdWxsZXQucHJvdG90eXBlID0ge1xuXG4gICAgICAgIHVwZGF0ZTogZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgIHRoaXMuY2VudGVyLnggKz0gdGhpcy52ZWxvY2l0eS54O1xuICAgICAgICAgICAgdGhpcy5jZW50ZXIueSArPSB0aGlzLnZlbG9jaXR5Lnk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgdmFyIEtleWJvYXJkZXIgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICB2YXIga2V5U3RhdGUgPSB7fTtcblxuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIGtleVN0YXRlW2Uua2V5Q29kZV0gPSB0cnVlO1xuICAgICAgICB9KTtcblxuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICBrZXlTdGF0ZVtlLmtleUNvZGVdID0gZmFsc2U7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuaXNEb3duID0gZnVuY3Rpb24oa2V5Q29kZSkge1xuICAgICAgICAgICAgcmV0dXJuIGtleVN0YXRlW2tleUNvZGVdID09PSB0cnVlO1xuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMuS0VZUyA9IHtcbiAgICAgICAgICAgIExFRlQ6IDM3LFxuICAgICAgICAgICAgUklHSFQ6IDM5LFxuICAgICAgICAgICAgUzogODNcbiAgICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBkcmF3UmVjdCA9IGZ1bmN0aW9uKHNjcmVlbiwgYm9keSkge1xuICAgICAgICBzY3JlZW4uZmlsbFJlY3QoYm9keS5jZW50ZXIueCAtIGJvZHkuc2l6ZS54IC8gMiwgYm9keS5jZW50ZXIueSAtIGJvZHkuc2l6ZS55IC8gMixcbiAgICAgICAgICAgIGJvZHkuc2l6ZS54LCBib2R5LnNpemUueSk7XG4gICAgfTtcblxuICAgIHZhciBjb2xsaWRpbmcgPSBmdW5jdGlvbihiMSwgYjIpIHtcbiAgICAgICAgcmV0dXJuICEoXG4gICAgICAgICAgICBiMSA9PT0gYjIgfHxcbiAgICAgICAgICAgIGIxLmNlbnRlci54ICsgYjEuc2l6ZS54IC8gMiA8IGIyLmNlbnRlci54IC0gYjIuc2l6ZS54IC8gMiB8fFxuICAgICAgICAgICAgYjEuY2VudGVyLnkgKyBiMS5zaXplLnkgLyAyIDwgYjIuY2VudGVyLnkgLSBiMi5zaXplLnkgLyAyIHx8XG4gICAgICAgICAgICBiMS5jZW50ZXIueCAtIGIxLnNpemUueCAvIDIgPiBiMi5jZW50ZXIueCArIGIyLnNpemUueCAvIDIgfHxcbiAgICAgICAgICAgIGIxLmNlbnRlci55IC0gYjEuc2l6ZS55IC8gMiA+IGIyLmNlbnRlci55ICsgYjIuc2l6ZS55IC8gMlxuICAgICAgICApO1xuICAgIH07XG5cbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICBuZXcgR2FtZSgpO1xuICAgIH0pO1xufSkoKTtcbiJdfQ==
